<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZARO REAL ESTATE | Luxury & Management</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>

    <style>
        :root { --gold: #c5a059; --dark: #111; --white: #fff; --gray: #f4f7f6; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--gray); color: var(--dark); }
        
        /* Navbar المطور */
        nav { background: var(--dark); padding: 12px 5%; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .logo { font-size: 22px; font-weight: bold; color: var(--gold); text-decoration: none; letter-spacing: 1px; }
        
        .user-nav-area { display: flex; align-items: center; gap: 15px; }
        .nav-btn { background: var(--gold); border: none; padding: 8px 18px; border-radius: 6px; cursor: pointer; font-weight: bold; color: #111; transition: 0.3s; }
        
        .profile-trigger { display: flex; align-items: center; gap: 10px; cursor: pointer; background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 30px; }
        .nav-avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 1.5px solid var(--gold); }

        /* Hero */
        .hero { height: 320px; background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=1200'); background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; color: white; text-align: center; }

        /* Grid */
        .container { padding: 40px 5%; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .card img { width: 100%; height: 200px; object-fit: cover; }
        .card-body { padding: 20px; }
        .price { color: var(--gold); font-size: 20px; font-weight: bold; }
        .main-btn { background: var(--dark); color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        /* Modals */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; width: 100%; max-width: 400px; position: relative; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        /* Settings Styles */
        .help-box { background: #eef2f7; padding: 15px; border-radius: 10px; margin: 15px 0; border-right: 4px solid #25d366; }
        .admin-link { color: #888; font-size: 11px; cursor: pointer; display: block; margin-top: 20px; text-align: center; }

        /* WhatsApp */
        .wa-float { position: fixed; bottom: 25px; left: 25px; background: #25d366; color: white; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; text-decoration: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; }
    </style>
</head>
<body>

<nav>
    <a href="#" class="logo">AZARO REAL ESTATE</a>
    <div class="user-nav-area">
        <div id="user-profile-nav" class="profile-trigger" style="display:none;" onclick="openModal('settingsModal')">
            <span id="nav-user-name" style="font-size: 13px;"></span>
            <img id="nav-user-img" src="https://via.placeholder.com/32" class="nav-avatar">
        </div>
        <button id="login-nav-btn" class="nav-btn" onclick="openModal('authModal')">دخول / تسجيل</button>
    </div>
</nav>

<section class="hero">
    <div>
        <h1 style="margin:0; font-size: 32px;">الرفاهية تبدأ من هنا</h1>
        <p>عقارات حصرية مخصصة لنمط حياتك</p>
    </div>
</section>

<div class="container" id="property-list">
    </div>

<div class="modal" id="authModal">
    <div class="modal-content">
        <span onclick="closeModal('authModal')" style="position:absolute; left:20px; cursor:pointer;">&times;</span>
        <h3>إنشاء حساب جديد</h3>
        <input type="text" id="regName" placeholder="الاسم الكامل">
        <input type="email" id="regEmail" placeholder="البريد الإلكتروني">
        <input type="password" id="regPass" placeholder="كلمة المرور">
        <input type="tel" id="regPhone" placeholder="رقم الهاتف">
        <button class="main-btn" style="background:var(--gold); color:black;" onclick="handleSignup()">تأكيد وانضمام</button>
    </div>
</div>

<div class="modal" id="settingsModal">
    <div class="modal-content">
        <span onclick="closeModal('settingsModal')" style="position:absolute; left:20px; cursor:pointer;">&times;</span>
        <h3 style="text-align:center;">إعدادات حسابي</h3>
        
        <div style="text-align:center; margin-bottom:15px;">
            <img id="setting-preview-img" src="https://via.placeholder.com/70" style="width:70px; height:70px; border-radius:50%; object-fit:cover; border:2px solid var(--gold);">
            <br>
            <input type="file" id="imgInput" style="display:none;" onchange="previewImg(event)">
            <button onclick="document.getElementById('imgInput').click()" style="background:none; border:none; color:var(--gold); cursor:pointer; font-size:12px; font-weight:bold;">تغيير الصورة</button>
        </div>

        <label style="font-size:13px;">الاسم الكامل:</label>
        <input type="text" id="setting-name" placeholder="الاسم الجديد">

        <div class="help-box">
            <h4 style="margin:0 0 5px 0;"><i class="fas fa-headset"></i> مركز المساعدة</h4>
            <p style="font-size:11px; margin-bottom:10px;">هل لديك استفسار عن عقار معين؟ فريقنا جاهز لمساعدتك.</p>
            <button onclick="window.open('https://wa.me/212600000000')" style="background:#25d366; color:white; border:none; padding:8px; border-radius:5px; width:100%; cursor:pointer; font-weight:bold;">تحدث مع الدعم</button>
        </div>

        <button class="main-btn" style="background:var(--gold); color:black;" onclick="updateProfile()">حفظ التغييرات</button>
        <p onclick="handleLogout()" style="color:red; text-align:center; cursor:pointer; font-size:12px; margin-top:15px;">تسجيل الخروج</p>
    </div>
</div>

<a href="https://wa.me/212669985826" class="wa-float"><i class="fab fa-whatsapp"></i></a>

<script>
    // 1. الربط مع Back4App (ضعي مفاتيحك هنا)
    Parse.initialize("TU8wdbgmuKMHpGp76QmMBIV2281RD6IVhg0NE4uS", "3AhKkYYWl0LVZWJQujXoVgSS5qaX76aod3qVBtFK");
    Parse.serverURL = 'https://parseapi.back4app.com/';

    // 2. عرض البيانات
    const properties = [
        { name: "شقة بانوراما - طنجة", price: "180,000", img: "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=500" },
        { name: "فيلا مودرن - مراكش", price: "2,400,000", img: "https://images.unsplash.com/photo-1613490493576-7fde63acd811?w=500" }
    ];

    document.getElementById('property-list').innerHTML = properties.map(p => `
        <div class="card">
            <img src="${p.img}">
            <div class="card-body">
                <span class="price">${p.price} درهم</span>
                <h3 style="margin:10px 0;">${p.name}</h3>
                <button class="main-btn" onclick="window.open('https://wa.me/212600000000')">طلب معاينة</button>
            </div>
        </div>
    `).join('');

    // 3. وظائف المودال
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // 4. نظام المستخدمين
    async function handleSignup() {
        const user = new Parse.User();
        user.set("username", document.getElementById('regEmail').value);
        user.set("email", document.getElementById('regEmail').value);
        user.set("password", document.getElementById('regPass').value);
        user.set("fullName", document.getElementById('regName').value);
        user.set("phone", document.getElementById('regPhone').value);

        try {
            await user.signUp();
            alert("✅ تم إنشاء حسابك بنجاح!");
            location.reload();
        } catch (e) { alert("❌ خطأ: " + e.message); }
    }

    function previewImg(e) {
        const file = e.target.files[0];
        if(file) document.getElementById('setting-preview-img').src = URL.createObjectURL(file);
    }

    async function updateProfile() {
        const user = Parse.User.current();
        const newName = document.getElementById('setting-name').value;
        const imgFile = document.getElementById('imgInput').files[0];

        if (newName) user.set("fullName", newName);
        if (imgFile) {
            const parseFile = new Parse.File("avatar.jpg", imgFile);
            user.set("profilePicture", parseFile);
        }

        try {
            await user.save();
            alert("✅ تم تحديث بياناتك");
            location.reload();
        } catch (e) { alert("❌ فشل التحديث"); }
    }

    async function handleLogout() {
        await Parse.User.logOut();
        location.reload();
    }

    // فحص الحالة عند الدخول
    function checkStatus() {
        const user = Parse.User.current();
        if (user) {
            document.getElementById('login-nav-btn').style.display = 'none';
            document.getElementById('user-profile-nav').style.display = 'flex';
            document.getElementById('nav-user-name').innerText = user.get('fullName');
            document.getElementById('setting-name').value = user.get('fullName');
            
            const pic = user.get('profilePicture');
            if (pic) {
                document.getElementById('nav-user-img').src = pic.url();
                document.getElementById('setting-preview-img').src = pic.url();
            }
        }
    }
    checkStatus();
</script>
</body>
</html>
