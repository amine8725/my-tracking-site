<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAKAN | شقق الدعم المباشر</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://npmcdn.com/parse/dist/parse.min.js"></script>

    <style>
        :root { --bg: #ffffff; --text: #000000; --gray: #f9f9f9; --support-red: #e63946; }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }
        
        nav { padding: 20px 5%; display: flex; justify-content: center; background: white; border-bottom: 1px solid #eee; sticky; top: 0; z-index: 1000; }
        .logo { font-size: 28px; font-weight: 800; letter-spacing: 5px; border-bottom: 3px solid #000; }

        .hero { padding: 50px 5%; text-align: center; border-bottom: 1px solid #eee; }
        .hero h1 { font-size: 24px; margin: 0; font-weight: 800; }
        .hero p { color: #666; font-size: 14px; margin-top: 5px; }

        .container { padding: 30px 5%; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; }
        .card { cursor: pointer; border-radius: 4px; overflow: hidden; transition: 0.3s; position: relative; }
        .card img { width: 100%; height: 260px; object-fit: cover; }
        .card-info { padding: 15px 0; }
        
        /* علامة الدعم فوق الصورة */
        .support-label { position: absolute; top: 10px; right: 10px; background: var(--support-red); color: white; padding: 4px 12px; font-size: 11px; font-weight: bold; border-radius: 2px; z-index: 10; }

        .price { font-size: 22px; font-weight: 800; color: #000; }
        .city { font-size: 13px; color: #888; text-transform: uppercase; letter-spacing: 1px; }

        /* صفحة التفاصيل */
        #detailsPage { display: none; position: fixed; inset: 0; background: white; z-index: 5000; overflow-y: auto; padding: 20px 5%; }
        .close-btn { font-size: 30px; cursor: pointer; display: block; margin-bottom: 15px; }
        .details-img { width: 100%; height: 300px; object-fit: cover; border-radius: 4px; }
        
        .spec-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; padding: 15px; background: var(--gray); border-radius: 4px; }
        .spec-grid div { font-size: 14px; color: #555; }
        .spec-grid div b { color: #000; display: block; font-size: 16px; }

        .btn-wa { background: #000; color: #fff; width: 100%; padding: 18px; border: none; font-family: 'Cairo'; font-size: 18px; font-weight: 800; text-decoration: none; display: block; text-align: center; margin-top: 25px; border-radius: 4px; }
        
        @media (max-width: 600px) { .details-img { height: 220px; } }
    </style>
</head>
<body>

<nav><div class="logo">MAKAN</div></nav>

<section class="hero">
    <h1>شقق 93م² مستفيدة من الدعم</h1>
    <p>الحاجب • فاس • سيدي قاسم • تاوجطات</p>
</section>

<div class="container" id="property-list"></div>

<div id="detailsPage">
    <span class="close-btn" onclick="closeDetails()">✕</span>
    <div id="detailsContent" style="max-width: 600px; margin: 0 auto;"></div>
</div>

<script>
    // 1. إعدادات Back4App (حطي المفاتيح ديالك هنا)
    Parse.initialize("TU8wdbgmuKMHpGp76QmMBIV2281RD6IVhg0NE4uS", "3AhKkYYWl0LVZWJQujXoVgSS5qaX76aod3qVBtFK");
    Parse.serverURL = 'https://parseapi.back4app.com/';

    // 2. رابط ديسكورد (WebHook)
    const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1465111327482708105/rrFvR8ThqXCp28WtaopCTPj8BRRHUzwfd92IbiECYK3B1n4qwy5qiKhHGGVY-A3GhPdN";

    // 3. بيانات الشقق
    const properties = [
        { id: 1, city: "الحاجب", name: "شقة الياسمين - وسط المدينة", price: "460,000", img: "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800", desc: "شقة رائعة مستوفية لشروط الدعم المباشر للسكن. تحتوي على 3 غرف وصالون ومطبخ مجهز بالكامل وحمامين." },
        { id: 2, city: "فاس", name: "إقامة الأندلس - طريق عين الشقف", price: "520,000", img: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800", desc: "تصميم عصري في موقع استراتيجي بفاس. المساحة 93 متر، صالون مغربي، 3 غرف نوم، ومطبخ مجهز." },
        { id: 3, city: "سيدي قاسم", name: "مجمع الورود السكني", price: "430,000", img: "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=800", desc: "شقة مشمشة بمدينة سيدي قاسم، جاهزة للتسليم وتقبل ملف الدعم المباشر. 3 غرف ومطبخ مجهز." },
        { id: 4, city: "تاوجطات", name: "شقق إقامة الأطلس", price: "410,000", img: "https://images.unsplash.com/photo-1484154218962-a197022b5858?w=800", desc: "هدوء وراحة بمساحة واسعة 93 متر في تاوجطات. 3 غرف وصالون كبير، تشطيبات عصرية." }
    ];

    // 4. وظائف الموقع
    function render() {
        document.getElementById('property-list').innerHTML = properties.map(p => `
            <div class="card" onclick="openDetails(${p.id})">
                <div class="support-label">يقبل الدعم المباشر</div>
                <img src="${p.img}">
                <div class="card-info">
                    <span class="city">${p.city}</span>
                    <div class="price">${p.price} درهم</div>
                    <div style="font-size:13px; color:#666;">93 م² • 3 غرف • مطبخ مجهز</div>
                </div>
            </div>
        `).join('');
    }

    function openDetails(id) {
        const p = properties.find(x => x.id === id);
        document.getElementById('detailsContent').innerHTML = `
            <img src="${p.img}" class="details-img">
            <h2 style="margin:15px 0 5px 0;">${p.name}</h2>
            <span style="color:var(--support-red); font-weight:800; font-size:14px;">✓ هذه الشقة مستفيدة من دعم السكن</span>
            
            <div class="spec-grid">
                <div>المساحة <b>93 م²</b></div>
                <div>الغرف <b>3 غرف</b></div>
                <div>الحمامات <b>2 حمام</b></div>
                <div>المطبخ <b>مجهز بالكامل</b></div>
            </div>

            <p style="line-height:1.8; color:#444;">${p.desc}</p>
            
            <a href="https://wa.me/21269985826?text=أنا مهتم بشقة ${p.name}" class="btn-wa">
                <i class="fab fa-whatsapp"></i> حجز معاينة عبر واتساب
            </a>
            <div style="height:40px;"></div>
        `;
        document.getElementById('detailsPage').style.display = 'block';
        document.body.style.overflow = 'hidden';
        notifyDiscord("رؤية عقار", `شخص يشاهد: ${p.name} (${p.city})`);
    }

    function closeDetails() {
        document.getElementById('detailsPage').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // 5. التتبع والزيارات (Back4App & Discord)
    async function trackVisit() {
        try {
            const Visit = Parse.Object.extend("Visits");
            const q = new Parse.Query(Visit);
            let v = await q.first() || new Visit();
            v.increment("count");
            await v.save();
        } catch(e) {}
    }

    async function notifyDiscord(title, desc) {
        if(!DISCORD_WEBHOOK.startsWith("http")) return;
        fetch(DISCORD_WEBHOOK, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ embeds: [{ title: title, description: desc, color: 0, timestamp: new Date() }] })
        });
    }

    window.onload = () => { render(); trackVisit(); };
</script>
</body>
</html>
